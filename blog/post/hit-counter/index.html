<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="icon" href="/assets/img/favicon.ico">
        <link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon"><meta name="theme-color" content="#343a40"><link rel="canonical" href="https://nitratine.net/blog/post/hit-counter/">

        <!-- Bootstrap core CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
        <link rel="stylesheet" href="/assets/css/base.css">
        <link rel="stylesheet" href="/assets/css/custom-bootstrap.css"><!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117153268-2"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-117153268-2');
        </script>
        <title>Hit Counter - Nitratine</title>
        <link rel="stylesheet" href="/assets/css/blog.css">
        <link rel="stylesheet" href="/assets/css/pygments.css">

        <meta name="description" content="Easily Count Hits on a Website by Requesting a SVG Displaying Hit Count. Works on any site.">
        <meta name="author" content="Brent Vollebregt">
        <meta property="og:title" content="Hit Counter">
        <meta property="og:description" content="Easily Count Hits on a Website by Requesting a SVG Displaying Hit Count. Works on any site.">
        <meta property="og:image" content="/post-assets/hit-counter/feature.png">
        <meta property="og:url" content="https://nitratine.net/blog/post/hit-counter/">
        <meta name="twitter:card" content="summary"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({
                      google_ad_client: "ca-pub-6407227183932047",
                      enable_page_level_ads: true
                 });
            </script>
    </head>

    <body>
        <!-- Navigation -->
        <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
            <div class="container">
                <a class="navbar-brand" href="/">
                    <img src="/assets/img/logo.png" width="145" height="30" class="d-inline-block align-top" alt="Brand Icon">
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-between" id="navbar">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item ">
                            <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link" href="/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.youtube.com/PyTutorials">YouTube</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://github.com/brentvollebregt">GitHub</a>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link" href="/about/">About</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main role="main" class="container">

            
            <div class="row">
                <div class="col-blog-content blog-main">

                    <h1 class="blog-post-title">Hit Counter</h1>
                    <p class="text-muted">
                        <a href="/blog/archive/#2018" class="text-muted">25 Apr 2018</a>
                        <a href="/blog/categories/#Projects" class="badge badge-primary ml-2">Projects</a>
                        
                        <a href="/blog/tags/#Python" class="badge badge-warning">Python</a>
                        
                        <a href="/blog/tags/#Flask" class="badge badge-warning">Flask</a>
                        
                        <img src="https://hitcounter.pythonanywhere.com/count/tag.svg" alt="Hits" class="post-hits">
                    </p>
                    <p class="lead">Easily Count Hits on a Website by Requesting a SVG Displaying Hit Count. Works on any site.</p>
                    <hr>

                    <div class="post-content">
                        <div style="text-align: center">
    <img src="https://hitcounter.pythonanywhere.com/nocount/tag.svg?url=https%3A%2F%2Fgithub.com%2Fbrentvollebregt%2Fhit-counter" alt="Hits">
</div>

<p><a href="https://github.com/brentvollebregt/hit-counter">Find the project on GitHub here</a></p>

<p><a href="https://github.com/brentvollebregt/hit-counter"><img src="https://img.shields.io/github/stars/brentvollebregt/hit-counter.svg?style=social" alt="Stars" style="margin-bottom: -5px; display: inline-block;"></a>
<a href="https://github.com/brentvollebregt/hit-counter"><img src="https://img.shields.io/github/forks/brentvollebregt/hit-counter.svg?style=social" alt="Forks" style="margin-bottom: -5px; display: inline-block;"></a></p>
<p>Live demo hosted at: <a href="https://hitcounter.pythonanywhere.com/">hitcounter.pythonanywhere.com</a></p>
<h2 id="what-is-this">What is This?</h2>
<p>This is a server that allows a client to request for a svg file that displays views for a url. This url can either be passed as a query parameter or the referrer (or referer) value in the header will be used.</p>
<p>These is also a small method to prevent the refresh count increase issue (if you want to call it an issue, I see it as annoying) which uses cookies.</p>
<p><strong>This makes is very easy too keep track of views on static sites like Github Pages.</strong> (can also be uses on non-static sites as a general counter)</p>
<h2 id="how-can-i-use-it">How Can I Use it?</h2>
<h3 id="getting-an-svg">Getting an SVG</h3>
<p>To get an image for the current url (for example is image is being requested by www.example.com), simply get the image as you normally would:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://hitcounter.pythonanywhere.com/count/tag.svg&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Hits&quot;</span><span class="p">&gt;</span>
</pre></div>


<p>In this example a hit would be added to the websites count on the server. To stop this form occurring but still get the svg file, use:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://hitcounter.pythonanywhere.com/nocount/tag.svg&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Hits&quot;</span><span class="p">&gt;</span>
</pre></div>


<h3 id="getting-the-count-raw">Getting the Count Raw</h3>
<p>If you don't want the SVG file but still want the count to use in something else, you can do a GET request to <code>/count</code> or as before <code>/nocount</code> to not add a count. For Example:</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nx">xmlHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://hitcounter.pythonanywhere.com/count&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="nx">count</span> <span class="o">=</span> <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
</pre></div>


<h3 id="getting-a-count-for-a-site-that-isnt-me">Getting a Count For a Site That Isn't Me</h3>
<p>There may be circumstances that the referrer may not be sent or you may want to request a SVG or count for another site. To do this, add a query with <code>url</code> as the name and the url you want to get (encoded obviously).</p>
<p>For example, getting an svg:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://hitcounter.pythonanywhere.com/nocount/tag.svg?url=www.example.com&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Hits&quot;</span><span class="p">&gt;</span>
</pre></div>


<p>And if you want to get the count:</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nx">targetUrl</span> <span class="o">=</span> <span class="s1">&#39;www.example.com&#39;</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">&#39;?url=&#39;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">targetUrl</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">xmlHttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://hitcounter.pythonanywhere.com/nocount&#39;</span> <span class="o">+</span> <span class="nx">query</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="nx">count</span> <span class="o">=</span> <span class="nx">xmlHttp</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
</pre></div>


<blockquote>
<p>There are also some situations where a client will not send the Referer in the header. This is a simple solution to the server not being able to find where the request came from.</p>
</blockquote>
<h2 id="generating-links-with-a-tool-hosted-by-the-server">Generating Links With A Tool Hosted By The Server</h2>
<p>Going to the location <code>/</code> on the server, you will be served with a HTML page that contains a tool to create the image tag or markdown element and search up a websites count.</p>
<p><img alt="Interface" src="/post-assets/hit-counter/interface.png" /></p>
<h2 id="hosting-your-own-server">Hosting Your Own Server</h2>
<p>Running this server is very easy, simple clone the repo (or download the files) and run <code>server.py</code></p>
<p>I host this on pythonaywhere.com; to do this make sure you have cloned the repo into the filesystem and then create a new project. Modify the "WSGI configuration file" under the "Code" header in the "Web" tab. Change line 16 to import your script and restart the application using the green button at the top.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">server</span> <span class="kn">import</span> <span class="n">app</span> <span class="k">as</span> <span class="n">application</span>
</pre></div>


<p>If you want to enable HTTPS on pythonaywhere, uncomment lines 5 and 8 in server.py to enable flask_sslify (is already installed on pythonaywhere, so you don't need to install it)</p>
<h2 id="how-it-works">How it Works</h2>
<p>This server has been built with Flask. Calling one of the <code>/count</code> or <code>/nocount</code> methods will interact with the local SQLite3 database (file) and keep track of urls, views and the counts for urls. Data will be returned based off what is in the database at the current time.</p>
<p>Cookies are used to prevent multiple counts for the same client in a specified period of time. These are simply the url as the key and a random string generated server side as the value.</p>
<h2 id="configuration">Configuration</h2>
<p>In config.py there are a few configurations that can be made</p>
<h3 id="database_filename">DATABASE_FILENAME</h3>
<p>This is the name of the SQLite3 database to be used, if it doesn't exist, it will be created. You don't need to worry about this unless you have conflicts with other applications.</p>
<h3 id="cookie_timeout">COOKIE_TIMEOUT</h3>
<p>This is the amount of time for a client to count as a view again. When a view is counted, the SVG/count is returned with a cookie for that site. Currently that is set at 1min (60 seconds) but can be changed.</p>
<p>To disable this feature simply set this to 0; the cookies stored on the server will be flushed from the database after each new view.</p>
<h3 id="svg_template">SVG_TEMPLATE</h3>
<p>This is the template of the SVG returned. <code>{count}</code> must always be in this string so that python can add the count before giving it as a response.</p>
<h3 id="random_value_length">RANDOM_VALUE_LENGTH</h3>
<p>This is the length of the value of the cookie stored both server and client side. Making this longer will stop collisions from occurring but will increase storage. Each value generated is completely random from the characters [0-9][a-z][A-Z].</p>
<h2 id="inspiration">Inspiration</h2>
<p>This project was inspired by <a href="https://github.com/dwyl/hits">github.com/dwyl/hits</a> which is a "General purpose hits (page views) counter" which unfortunately will count GitHub repo views. This was my idea to expand on this and add some features with also making it compatible with any site.</p>
<h2 id="why-does-the-anti-refresh-system-not-work">Why Does The Anti-Refresh System Not Work?</h2>
<p>On sites like github.com, images are cached. Even though I declare no-cache in the header, GitHub will load the image on their side first which will cause an increase in the count no matter what as it isn't passing back the cookie it got previously (and if it did there would be a timeout for everyone).</p>
                    </div>

                    <nav class="blog-pagination text-center mb-5 mt-4">
                        
                            <a class="btn btn-outline-primary mt-1" href="/blog/post/my-desktop-backgrounds/">&larr; My Desktop Backgrounds</a>
                        
                        
                            <a class="btn btn-outline-primary mt-1" href="/blog/post/github-badges/">Github Badges &rarr;</a>
                        
                    </nav>

                    
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function() {
                            this.page.url = 'https://nitratine.net/blog/post/hit-counter/'; // Your page's canonical URL variable
                            this.page.identifier = 'https://nitratine.net/blog/post/hit-counter/'; // Your page's unique identifier variable
                        };
                        (function() {
                            var d = document,
                                s = d.createElement('script');
                            s.src = '//nitratine.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                    

                </div>

                                <!-- Sidebar -->
                <aside class="col-blog-sidebar blog-sidebar">

                    <div class="card p-3 mb-3 bg-light">
                        <h4 class="text-center text-lg-left">About</h4>
                        <p class="mb-0">Owner of <a href="https://www.youtube.com/PyTutorials">PyTurorials</a> and creator of <a href="https://github.com/brentvollebregt/auto-py-to-exe">auto-py-to-exe</a>. I enjoy making quick tutorials for people new to particular topics in Python and  tools that help fix small things.</p>
                    </div>

                    <div class="input-group mb-3">
                      <input id="search" type="text" class="form-control" placeholder="Search" aria-label="Search">
                        <div class="input-group-append">
                            <button id="search-submit" class="btn btn-outline-primary" type="button">Search</button>
                        </div>
                    </div>
                    <script>let searchUrl = "/search/";</script>
                    <script type="text/javascript" defer src="/assets/js/search.js"></script>

                    <div class="card p-3 mb-3 bg-light">
                        <h4 class="text-center text-lg-left">Categories</h4>
                        <ol class="list-unstyled mb-0 text-center text-lg-left">
                            
                                <li>
                                <a href="/blog/categories/#Apps">&#x1F4F1; Apps
                                    <span class="badge badge-primary ml-3">2</span>
                                </a>
                            </li>
                            
                                <li>
                                <a href="/blog/categories/#General">&#x1F4F0; General
                                    <span class="badge badge-primary ml-3">5</span>
                                </a>
                            </li>
                            
                                <li>
                                <a href="/blog/categories/#Investigations">&#x1F50D; Investigations
                                    <span class="badge badge-primary ml-3">2</span>
                                </a>
                            </li>
                            
                                <li>
                                <a href="/blog/categories/#Projects">&#x1F4BE; Projects
                                    <span class="badge badge-primary ml-3">13</span>
                                </a>
                            </li>
                            
                                <li>
                                <a href="/blog/categories/#Tutorials">&#x1F4D6; Tutorials
                                    <span class="badge badge-primary ml-3">8</span>
                                </a>
                            </li>
                            
                                <li>
                                <a href="/blog/categories/#YouTube">&#x1F3A5; YouTube
                                    <span class="badge badge-primary ml-3">15</span>
                                </a>
                            </li>
                            
                        </ol>
                    </div>

                    <div class="card p-3 mb-3 bg-light">
                        <h4 class="text-center text-lg-left">PyTutorials on YouTube</h4>
                        <script src="https://apis.google.com/js/platform.js"></script>
                        <div style="text-align: center">
                            <div class="g-ytsubscribe" data-channel="PrivateSplat" data-layout="full" data-count="default"></div>
                        </div>
                    </div>

                    <div class="card p-3 mb-3 bg-light">
                        <h4 class="text-center text-lg-left">Recent Videos</h4>
                        <div id="recent-yt-videos" class="yt_video_container"></div>
                    </div>

                    <script>
                        let youtube_data_api_key = 'AIzaSyDz6QJ7H1Ca575XwvKnO8Q4MVATUxLdHYM';
                        let youtube_channel_id = 'UCesEknt3SRX9R9W_f93Tb7g';
                    </script>
                    <script type="text/javascript" defer src="/assets/js/getRecentYouTubeVideos.js"></script>

                </aside>

            </div>


        </main>

        <!-- Bootstrap -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    </body>
</html>