<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="icon" href="/assets/img/favicon.ico">
        <link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon"><meta name="theme-color" content="#343a40"><link rel="canonical" href="https://nitratine.net/blog/post/google-publisher-toolbar-please-copy-this-code/">

        <!-- Bootstrap core CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
        <link rel="stylesheet" href="/assets/css/base.css">
        <link rel="stylesheet" href="/assets/css/custom-bootstrap.css"><!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117153268-2"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-117153268-2');
        </script><!-- instant.page -->
        <script defer src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>

        
        <title>Google Publisher Toolbar: Please copy this code - Nitratine</title>
        <link rel="stylesheet" href="/assets/css/blog.css">
        <link rel="stylesheet" href="/assets/css/pygments.css">

        <meta name="description" content="When first installing Google Publisher Toolbar, you may be asked, &#34;Please copy this code, switch to your application and paste it there&#34;. In this post I look into a method on how to fix this and allow you to use the extension.">
        <meta name="author" content="Brent Vollebregt">
        <meta property="og:title" content="Google Publisher Toolbar: Please copy this code">
        <meta property="og:description" content="When first installing Google Publisher Toolbar, you may be asked, &#34;Please copy this code, switch to your application and paste it there&#34;. In this post I look into a method on how to fix this and allow you to use the extension.">
        <meta property="og:image" content="/post-assets/google-publisher-toolbar-please-copy-this-code/message.png">
        <meta property="og:url" content="https://nitratine.net/blog/post/google-publisher-toolbar-please-copy-this-code/">
        <meta name="twitter:card" content="summary"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({
                      google_ad_client: "ca-pub-6407227183932047",
                      enable_page_level_ads: true
                 });
            </script>
    </head>

    <body>
        <!-- Navigation -->
        <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
            <div class="container">
                <a class="navbar-brand" href="/">
                    <img src="/assets/img/logo.png" width="145" height="30" class="d-inline-block align-top" alt="Brand Icon">
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-between" id="navbar">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item ">
                            <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link" href="/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://www.youtube.com/PyTutorials">YouTube</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://github.com/brentvollebregt">GitHub</a>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link" href="/about/">About</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main role="main" class="container">

            
            <div class="row">
                <div class="col-blog-content blog-main">

                    <h1 class="blog-post-title">Google Publisher Toolbar: Please copy this code</h1>
                    <p class="text-muted">
                        <a href="/blog/archive/#2019" class="text-muted">24 Apr 2019</a>
                        <a href="/blog/categories/#Tutorials" class="badge badge-primary ml-2">Tutorials</a>
                        
                        <a href="/blog/tags/#google" class="badge badge-warning">google</a>
                        
                        <a href="/blog/tags/#chrome-extension" class="badge badge-warning">chrome-extension</a>
                        
                        <img src="https://hitcounter.pythonanywhere.com/count/tag.svg" alt="Hits" class="post-hits">
                    </p>
                    <p class="lead">When first installing Google Publisher Toolbar, you may be asked, &#34;Please copy this code, switch to your application and paste it there&#34;. In this post I look into a method on how to fix this and allow you to use the extension.</p>
                    <hr>

                    <div class="post-content">
                        <div class="toc">
<ul>
<li><a href="#the-problem">The Problem</a></li>
<li><a href="#looking-at-the-source-of-the-extension">Looking at the Source of the Extension</a></li>
<li><a href="#looking-for-what-should-be-executed">Looking for what Should be Executed</a></li>
<li><a href="#executing-the-javascript">Executing the JavaScript</a></li>
<li><a href="#a-possibly-easier-solution">A Possibly Easier Solution</a></li>
</ul>
</div>
<h2 id="the-problem">The Problem</h2>
<p>When installing the latest version of the Chrome extension <em>Google Publisher Toolbar</em> and then trying to connect/enable Google AdSense or Google Analytics, you may be given a prompt to "<strong>Please copy this code, switch to your application and paste it there:</strong>" followed by a code that you can copy like in the image below.</p>
<p><img alt="Google Publisher Toolbar Asking the User to Copy the Code" src="/post-assets/google-publisher-toolbar-please-copy-this-code/message.png" /></p>
<p>After quite a bit of digging, I couldn't find any solutions to this problem which meant I had to give up or think about the problem. Of course I wanted to use this tool, so I thought about it.</p>
<blockquote>
<p>Please note that these steps described in this post may not work for everyone. These are the steps I took and they seem reliable; however file names and contents can change.</p>
</blockquote>
<p>My first thought was that something should be picking this code up automatically, in particular the Google Publisher Toolbar extension. Chrome extensions use JavaScript which can easily be viewed using some sort of extension viewer. </p>
<h2 id="looking-at-the-source-of-the-extension">Looking at the Source of the Extension</h2>
<p>There are a <a href="https://gist.github.com/paulirish/78d6c1406c901be02c2d">few options</a> when trying to view a Chrome extensions source but I decided to take an online tool approach as it would streamline the process of extracting everything. I ended up using <a href="https://robwu.nl/crxviewer/">robwu.nl/crxviewer/</a> which simply asks for the URL of a Chrome extension (plus some other options).</p>
<p><img alt="Loading the Google Publisher Toolbar URL into the CRXViewer" src="/post-assets/google-publisher-toolbar-please-copy-this-code/crxviewer.png" /></p>
<p>Providing it the <a href="https://chrome.google.com/webstore/detail/google-publisher-toolbar/omioeahgfecgfpfldejlnideemfidnkc">URL of Google Publisher Toolbar on the Chrome Web Store</a> and leaving all the other options as default, I then clicked "Open in this viewer" to view the extensions source.</p>
<h2 id="looking-for-what-should-be-executed">Looking for what Should be Executed</h2>
<p>When the source first loads, it may appear that there are a lot of files, but many of them are translations for different languages. The best way to get a hint of what to look for, is to look at the <code>manifest.json</code> file. Viewing this file gives details like the name, version, icons and what scripts are run where; this is definitely the place for insight into what I was looking for.</p>
<p>If you look back at the URL we were told to "<strong>Please copy this code, switch to your application and paste it there:</strong>" on, you would have notice that it followed something like <code>https://accounts.google.com/o/oauth2/approval/v2/approvalnativeapp?...</code> <em>(yours may be different)</em>; this is good to remember as this is where a JavaScript script should have picked up the token.</p>
<p>In the <code>manifest.json</code> file, under the <a href="https://developer.chrome.com/extensions/content_scripts"><code>content_scripts</code></a> key is a list of objects that describe what files that run in the context of web pages at particular URLs.</p>
<p><img alt="content_scripts in the manifest.json" src="/post-assets/google-publisher-toolbar-please-copy-this-code/content-scripts.png" /></p>
<p>Each object in this list contains a <code>matches</code> key; this contains a list of all the URL matches where particular scripts are allowed to run. In the same object under the <code>js</code> key is a list of all the scripts that can run on the matched URLs. In the screenshot above, the third object contains the following:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;matches&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;https://accounts.google.com/o/oauth2/approval?*&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://accounts.google.com/o/oauth2/approval/v2/approvalnativeapp?*&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;js&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;contentscript_oauth_response_handler.js&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;all_frames&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;run_at&quot;</span><span class="p">:</span> <span class="s2">&quot;document_idle&quot;</span>
<span class="p">}</span>
</pre></div>


<p>The URLs that can be matched in this content script object match the original URL we are looking for; <code>https://accounts.google.com/o/oauth2/approval/v2/approvalnativeapp?...</code> is matched by <code>https://accounts.google.com/o/oauth2/approval?*</code> <em>(* means anything)</em>. This means the JavaScript in the <code>contentscript_oauth_response_handler.js</code> is what should be running.</p>
<p>Open this file by searching for it on the left. The file is averagely sized and has been compressed as all function names have been renamed. This isn't an issue though as all the code is this file is wrapped in <code>(function() { &lt;code&gt; })();</code> which will mean this immediately gets executed when the script loads.</p>
<h2 id="executing-the-javascript">Executing the JavaScript</h2>
<p>Copy all the code from <code>contentscript_oauth_response_handler.js</code> onto the clipboard <em>(Ctrl + C)</em> and try to enable AdSense or Analytics in the Google Publisher Toolbar extension again. You should be presented with the <em>Please copy this code, switch to your application and paste it there:</em> page again; this is good as we haven't changed anything yet.</p>
<p>Press <code>F12</code> on this page to open Chrome dev tools. Go to the <code>Console</code> tab <em>(select it on the top bar)</em> and paste the code copied previously in this window.</p>
<p><img alt="Pasted JavaScript in Chome DevTools" src="/post-assets/google-publisher-toolbar-please-copy-this-code/pasted-js.png" /></p>
<p>After pasting the code, press enter. An error may be displayed with <code>Uncaught TypeError: Cannot read property 'sendMessage' of undefined</code>; ignore this and close the tab. Now when clicking on the Google Publisher Toolbar, you should see that the extension read the token and you can use Google Publisher Toolbar; repeat for the other service (AdSense/Analytics) if required.</p>
<h2 id="a-possibly-easier-solution">A Possibly Easier Solution</h2>
<p>While testing this method, it appeared to me that this script was being executed too fast on page load. In some cases, I found that simply refreshing the page that asks you to copy the code out will trigger the script to run again and thus take the token.</p>
<p>I cannot guarantee this method will have a better accuracy than the last method but it's still worth a shot.</p>
                    </div>

                    <nav class="blog-pagination text-center mb-5 mt-4">
                        
                            <a class="btn btn-outline-primary mt-1" href="/blog/post/python-requests-tutorial/">&larr; Python Requests Tutorial</a>
                        
                        
                            <a class="btn btn-outline-primary mt-1" href="/blog/post/how-to-hash-files-in-python/">How to Hash Files in Python &rarr;</a>
                        
                    </nav>

                    
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function() {
                            this.page.url = 'https://nitratine.net/blog/post/google-publisher-toolbar-please-copy-this-code/'; // Your page's canonical URL variable
                            this.page.identifier = 'https://nitratine.net/blog/post/google-publisher-toolbar-please-copy-this-code/'; // Your page's unique identifier variable
                        };
                        (function() {
                            var d = document,
                                s = d.createElement('script');
                            s.src = '//nitratine.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                    

                </div>

                                <!-- Sidebar -->
                <aside class="col-blog-sidebar blog-sidebar">

                    <div class="card p-3 mb-3 bg-light">
                        <h4 class="text-center text-lg-left">About</h4>
                        <p class="mb-0">Owner of <a href="https://www.youtube.com/PyTutorials">PyTurorials</a> and creator of <a href="https://github.com/brentvollebregt/auto-py-to-exe">auto-py-to-exe</a>. I enjoy making quick tutorials for people new to particular topics in Python and  tools that help fix small things.</p>
                    </div>

                    <div class="input-group mb-3">
                      <input id="search" type="text" class="form-control" placeholder="Search" aria-label="Search">
                        <div class="input-group-append">
                            <button id="search-submit" class="btn btn-outline-primary" type="button">Search</button>
                        </div>
                    </div>
                    <script>let searchUrl = "/search/";</script>
                    <script type="text/javascript" defer src="/assets/js/search.js"></script>

                    <div class="card p-3 mb-3 bg-light">
                        <h4 class="text-center text-lg-left">Categories</h4>
                        <ol class="list-unstyled mb-0 text-center text-lg-left">
                            
                                <li>
                                <a href="/blog/categories/#Apps">&#x1F4F1; Apps
                                    <span class="badge badge-primary ml-3">2</span>
                                </a>
                            </li>
                            
                                <li>
                                <a href="/blog/categories/#General">&#x1F4F0; General
                                    <span class="badge badge-primary ml-3">6</span>
                                </a>
                            </li>
                            
                                <li>
                                <a href="/blog/categories/#Investigations">&#x1F50D; Investigations
                                    <span class="badge badge-primary ml-3">2</span>
                                </a>
                            </li>
                            
                                <li>
                                <a href="/blog/categories/#Projects">&#x1F4BE; Projects
                                    <span class="badge badge-primary ml-3">13</span>
                                </a>
                            </li>
                            
                                <li>
                                <a href="/blog/categories/#Tutorials">&#x1F4D6; Tutorials
                                    <span class="badge badge-primary ml-3">11</span>
                                </a>
                            </li>
                            
                                <li>
                                <a href="/blog/categories/#YouTube">&#x1F3A5; YouTube
                                    <span class="badge badge-primary ml-3">15</span>
                                </a>
                            </li>
                            
                        </ol>
                    </div>

                    <div class="card p-3 mb-3 bg-light">
                        <h4 class="text-center text-lg-left">PyTutorials on YouTube</h4>
                        <script src="https://apis.google.com/js/platform.js"></script>
                        <div style="text-align: center">
                            <div class="g-ytsubscribe" data-channel="PrivateSplat" data-layout="full" data-count="default"></div>
                        </div>
                    </div>

                    <div class="card p-3 mb-3 bg-light">
                        <h4 class="text-center text-lg-left">Recent Videos</h4>
                        <div id="recent-yt-videos" class="yt_video_container"></div>
                    </div>

                    <script>
                        let youtube_data_api_key = 'AIzaSyDz6QJ7H1Ca575XwvKnO8Q4MVATUxLdHYM';
                        let youtube_channel_id = 'UCesEknt3SRX9R9W_f93Tb7g';
                    </script>
                    <script type="text/javascript" defer src="/assets/js/getRecentYouTubeVideos.js"></script>

                </aside>

            </div>


        </main>

        <!-- Bootstrap -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    </body>
</html>